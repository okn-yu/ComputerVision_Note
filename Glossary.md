## 前提
* 光の反射は拡散反射と鏡面反射の2種類に分類できる
* 物理現象としては単純化した近似であるが精度が出るためよいとされている

## 物理現象としての光

### 拡散反射
* diffuse
* 物体表面に入射してきた光が、フレネル光学現象の結果、屈折して物体内部に一旦進入し、その物体の内部で様々な方向に散乱を多重に繰り返した結果、再び物体の外に出ていく光
* 光の波長のうち物体内に吸収されてしまう成分も出てくるため、反射光の色合いは光源とは異なり物体固有の色合いとなる
* 例：リンゴなら赤
* 一般にザラザラした物体の表面で強く発生する
* 反射光があらゆる方向に等しいと仮定した理想拡散反射をランバード反射と呼ぶ

### 鏡面反射
* specular
* 物体表面に入射した光が、フレネル光学現象の結果、物体表面でそのまま反射した光
* 光源の光がそのまま反射されるため、基本的には反射光は光源の色合いがそのまま残る
* 一般に滑らかな物体の表面で強く発生する

## 計算モデル
### BSDF(Bidirectional Scattering Distribution Function)
* 双方向散乱分布関数
* BSDF = BRDF + BTDF

### BRDF(Bidirectional Reflectance Distribution Function)
* 双方向反射率分布関数
* 反射モデルの1つ
* 光の入射方向、物体表面上の光の入射・出射がなされる位置座標、光の出射方向の３つを引数にとる確率密度関数
* ある材質の物体表面のとある位置ｘに、ある方向ω'から光が入射してきた時、別の方向ωへと出射していく光の割合
* 光の入射位置と反射位置は同一と仮定
* BRDFでは反射は「拡散反射」「鏡面反射」「光沢反射」に分類されると仮定
* BRDFの拡散反射は、反射光は入射位置を中心にあらゆる方向に等しく反射すると仮定
* BRDFの鏡面反射は、反射光は入射光の正反射方向に反射すると仮定

### SVBRDF(Spatially Variant Bidirectional Reflectance Distribution Function)
* 反射モデルの1つ
* 物体表面の場所による差分を考慮したBRDF

### BSSRDF(Bidirectional Scattering Surface Reflectance Distribution Function)
* 反射モデルの1つ
* 入射した光が物体内部で散乱を繰り返し入射位置とは異なる位置から出射すると仮定
* BSSRDFにおいて入射位置と射出位置が十分に近いと近似するとBRDF

### BTDF(Bidirectional Transmittance Distribution Function)
* 双方向透過率分布関数
* 光の透過モデルの1つ
* 透過(屈折)現象が入射点と同じ点で起こるという仮定

## CVの一般用語
### レンダリング方程式
* 真空中での光の輸送・伝達を記述した方程式
* 積分方程式
* パストレーシングの数値計算に用いられる
* 反射・透過する光の量を計算するためにはあらゆる入射方向に関して積分を解く必要があるが一般的には解析的に解くのは困難
* そのためモンテカルロ法などの近似を行う
* レンダリング方程式は大域照明も考慮した式になっているため、解けば大域照明も満たされる

### ボリュームレンダリング方程式
* レンダリング方程式に加えて空間中の媒質における散乱も考慮に加えた方程式

### 大域照明
* 光源から直接届く光の影響だけでなく、他の物体に1回以上反射して間接的に届く光の影響も計算に含めること
* 反射光自体を新たな光源として考慮する（間接照明）
* 大域照明を考慮しない場合はシーン全体が過度に暗くなる

### Shading
* 光の角度と光源からの距離を考慮して物体表面の色を変化させることで、物体を実写のようにリアルに表示させる処理
* 日本語では陰影付け
* Shadingの具体的な実行方法は反射モデルを用いた計算

### ライティング
* 3DCG作成における工程の1つ
* 3DCGに光源を設定する
* 仕上げに近い工程
* 3DCGで写実的なリアルさ以外に演出的な効果も考慮する

### レイトレーシング
* モデリング手法の1つ
* カメラから仮想的な光線(ray)を飛ばし、光線と物体が当たっているかどうかを調べることで画面に出す色を決定する
* 1本1本の光線の追跡に多くの計算を必要とするため画像生成に時間がかかる
* 鏡面反射の計算量は増えない
* 透明や鏡面でない物体の表面は周囲のあらゆる方向へ光を乱反射しているため計算量が指数関数的に増える
* 拡散反射は乱数によってランダムに選ばれた方向のみに限定することで計算量を現実的な処理量に抑えたMCRTを用いる

### パストレーシング
* モデリング手法の1つ
* レンダリング方程式に基づいて光の挙動をシミュレーションするアルゴリズム
* レイトレーシングの1つでありレイトレーシングを拡張･強化したレンダリング方法
* モンテカルロ・レイトレーシング(Monte Carlo Ray Tracing, MCRT)と呼ばれる手法の1つ
* モンテカルロ法を用いてレンダリング方程式の解を求める
* パストレーシングでは現実の光の向きとは逆にセンサーから光源までの光輸送経路を考える
* 大域照明を解くMCRTの中では最も基本的な手法
* 入射方向のサンプリング数も基本的には1つに絞る（拡散反射する表面での逆追跡が必要な経路をランダムに1つだけとする）ことで、再帰的な反射・透過を扱いながらも計算量の爆発を抑える
* その場合レンダリング画像には推定結果の分散が視覚的なノイズとして現れるが、パストレーシングを何回も行い平均をとることで分散を低減させる


## 参考リンク
* https://qiita.com/emadurandal/items/3a8db7bc61438245654d
* https://book.mynavi.jp/files/topics/54178_ext_90_0.pdf
* https://trap.jp/post/324/
* http://kagamin.net/hole/edupt/edupt_v103.pdf
